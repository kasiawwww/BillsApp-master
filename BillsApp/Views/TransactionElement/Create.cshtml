@model IEnumerable<BillsAppDatabase.TransactionElement>

@{
    ViewData["Title"] = "Create";
}

<h2>Create</h2>

<h4>TransactionElement</h4>
<table id="tblTransactionElements" class="table" cellpadding="0" cellspacing="0">
    <thead>
        <tr>
            <th style="width:150px">Product</th>
            <th style="width:150px">Price</th>
            <th style="width:150px">Amount</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <td>@item.Product</td>
            <td>@item.Price</td>
            <td>@item.Amount</td>
            <td><input type="button" value="Remove" onclick="Remove(this)" /></td>
        </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <td><input type="text" id="txtProduct" /></td>
            <td><input type="number" id="txtPrice" /></td>
            <td><input type="number" id="txtAmount" /></td>
            <td><input type="button" id="btnAdd" value="Add" /></td>
        </tr>
    </tfoot>
</table>
<br />
<input type="button" id="btnSave" value="Save All" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<script type="text/javascript">
    debugger;
        $("body").on("click", "#btnAdd", function () {
            var txtProduct = $("#txtProduct");
            var txtPrice = $("#txtPrice");
            var txtAmount = $("#txtAmount");

            var tBody = $("#tblTransactionElements > TBODY")[0];

            var row = tBody.insertRow(-1);

            var cell = $(row.insertCell(-1));
            cell.html(txtProduct.val());

            cell = $(row.insertCell(-1));
            cell.html(txtPrice.val());

            cell = $(row.insertCell(-1));
            cell.html(txtAmount.val());

            cell = $(row.insertCell(-1));
            var btnRemove = $("<input />");
            btnRemove.attr("type", "button");
            btnRemove.attr("onclick", "Remove(this);");
            btnRemove.val("Remove");
            cell.append(btnRemove);

            //Clear the TextBoxes.
            txtProduct.val("");
            txtPrice.val("");
            txtAmount.val("");

        });

        function Remove(button) {
            var row = $(button).closest("TR");
            var name = $("TD", row).eq(0).html();
            if (confirm("Do you want to delete: " + name)) {
                var table = $("#tblTransactionElements")[0];

                table.deleteRow(row[0].rowIndex);
            }
        };

        $("body").on("click", "#btnSave", function () {
            var transactionElements = new Array();
            debugger;
            $("#tblTransactionElements TBODY TR").each(function () {
                var row = $(this);
                var transactionElelemt = {};
                transactionElelemt.Product = row.find("TD").eq(0).html();
                transactionElelemt.Price = row.find("TD").eq(1).html();
                transactionElelemt.Amount = row.find("TD").eq(2).html();

                transactionElements.push(transactionElelemt);
            });

            var data = JSON.stringify({ elements: transactionElements });
            //Send the JSON array to Controller using AJAX.
            $.ajax({
                type: "POST",
                url: "Create",
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (r) {
                    alert(r + " record(s) inserted.");
                }
            });
        });
</script>
